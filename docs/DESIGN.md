# La Matatena – BGG Card Deck Web App: Vibe Coding Design Doc

## Philosophy

This is an **AI-assisted coding project**. The intent is to treat this document
as the **source of truth** for both humans and AI tools. It provides context,
goals, stack choices, and conventions so that every contribution — whether
written by a human or suggested/generated by AI — stays aligned.

We call this **vibe coding**:
- **AI as partner**: Handles scaffolding, repetitive tasks, and boilerplate.
- **Human as director**: Guides design, reviews code, ensures intent is
  preserved.
- **Anchor with context**: Always include this document in prompts when asking
  AI for help.
- **Consistency**: AI should adhere to the decisions here unless explicitly told
  otherwise.
- If an instruction **conflicts with a stated convention** or requires deviating
  from the stack/design, the AI must **update this document** accordingly.
- Example: if told to switch from Puppeteer to `pdf-lib`, the AI must add that
  change here, marking the new convention and deprecating the old one.

This document is designed to be **self-sufficient**. If an AI reads only this
file, it should be able to understand the project’s scope, constraints, and
style.

---

## Project overview

This app generates printable **TCG-style cards** from a user’s
[BoardGameGeek](https://boardgamegeek.com/) collection.

- **Card fronts**: cover art, title, player counts, weight, playing time, short
  description, designer, artist.
- **Card backs**: La Matatena logo on a configurable background.
- **Output**: print-ready PDF in A4 or Letter, 300 DPI, with crop marks and
  optional bleed.

Use cases:
- Quick reference when teaching games.
- Player aids for game nights.
- Personal collection souvenirs.

---

## Goals

- Fetch a BGG user’s owned games.
- Render card fronts and backs at **poker card size** (63.5 × 88.9 mm).
- Cache cover images and short descriptions.
- Export print-ready PDFs (A4/Letter, crop marks, bleed).
- Maintain **developer experience optimized for AI collaboration**.

### Non-goals (v1)

- Authentication (only username input, no BGG login).
- Commercial prepress workflows (CMYK, Pantone).
- Custom card layouts or themes.

---

## Vibe coding strategy

- **AI scope**: generating components, boilerplate, APIs, documentation, and
  tests.
- **Human scope**: deciding architecture, reviewing code, clarifying edge cases,
  curating the vibe.
- **Prompting guidelines**:
- Always paste or reference this document when asking AI to generate code.
- Tell the AI *what you’re working on* and *where in the repo it belongs*.
- Ask for **complete files** when possible (to avoid fragmentation).
- If AI is asked to **break or change a convention**, it must update this
  document to reflect the new rule, so future contributions remain aligned.

---

## Stack and architecture

### Frontend
- **Framework**: Next.js (App Router) + React + TypeScript.
- **Styling**: Tailwind CSS with shadcn/ui for UI components.
- **Icons**: Inline SVGs for card stats (players, stopwatch, weight pips).
  lucide-react for UI chrome.
- **State**: Zustand for lightweight global state.

### Data fetching
- Next.js Route Handlers proxy the BGG XML API2.
- Responses are parsed with `fast-xml-parser`.
- Validated with `zod`.

### Caching
- **Server**: KV store for Short Descriptions (TTL 90 days, stale-while-
  revalidate 7 days).
- **Client**: Service Worker + Cache Storage for images, IndexedDB for game
  metadata.
- **Images**: cached for 1 year (immutable).

### PDF generation
- **v1 (MVP)**: Headless Chrome (Puppeteer/Playwright) renders the `/print`
  route.
- **v2 (planned)**: SVG + resvg/pdf-lib pipeline for vector precision and
  reduced resource usage.

### Deployment
- Preferred: **Vercel** (Next.js native).
- Alternative: Cloudflare Pages + Workers.

---

## Data sources

- **BGG XML API2**
- `/collection?username=...` → list of owned games.
- `/thing?id=...&stats=1` → detailed metadata.

- **Short Description**
- Not exposed in XML API.
- Scraped from the HTML `<meta name="description">` or `<meta
  property="og:description">`.
- Cached for 90 days (server-side KV).
- No manual refresh button; revalidation happens in background.

### Field mapping
- Title → `thing.name`
- Short description → scraped meta description
- Min/max players → `minplayers`, `maxplayers`
- Play time → `playingtime` (minutes)
- Weight → `averageweight` mapped to 1–5 icons (+ numeric)
- Designer → `link[type=boardgamedesigner]`
- Artist → `link[type=boardgameartist]`
- Cover art → `image` (or `thumbnail` fallback)

---

## Card layout

- **Size**: Poker (63.5 × 88.9 mm), safe area + 3 mm bleed.
- **Front**:
- Top half: cover art.
- Overlay: title, player counts, weight, playing time.
- Bottom: short description, designer, artist.
- **Back**:
- Solid background (configurable).
- Centered La Matatena logo (SVG).
- **PDF sheets**:
- 3×3 grid on A4 or Letter.
- 5 mm gutters, optional 3 mm bleed.
- Crop marks.
- Duplex printing (long-edge flip alignment).

---

## Development guidelines

- **TypeScript first**: enforce typing everywhere.
- **SVG everywhere**: for icons, logos, and crop marks → crisp in print.
- **Accessibility**: alt text for images, keyboard navigation, good color
  contrast.
- **Internationalization**: English + Spanish UI (JSON dictionaries).
- **Caching discipline**: version cache keys; prefer stale-while-revalidate
  patterns.
- **Testing**:
- Unit tests for data parsers (weight → icons, short description extraction).
- Integration tests for API routes (mocked XML).
- Visual regression tests for cards (Playwright screenshots).

---

## Risks and mitigations

- **BGG rate limits / 202 responses**
- Batch requests (max 100 IDs).
- Cache aggressively.
- Exponential backoff.

- **Puppeteer resource usage**
- Cap concurrent renders.
- If scale increases, migrate to SVG/pdf-lib pipeline.

- **BGG markup changes**
- If short description selector breaks, bump cache key version and update
  scraper.

- **Long titles / credits**
- Truncate with ellipsis.
- For designers/artists: show max 2 + “+N more”.

---

## Milestones

1. Scaffold Next.js app with Tailwind + shadcn.
2. Add BGG API proxy and XML→JSON transform.
3. Implement short description scraper + 90-day cache.
4. Build card front/back components.
5. Add sheet preview (3×3 layout, crop marks).
6. Implement Puppeteer PDF export.
7. Add polish: i18n, accessibility, cache management.
8. **Future**: migrate to SVG/pdf-lib pipeline.

---

## Future enhancements

- OAuth/private BGG collections.
- Custom themes for cards (accent colors from cover art).
- QR codes linking to BGG pages.
- Seasonal La Matatena backs.
- CSV import for non-BGG games.
- Save/load project configurations locally.

---

## Folder structure (planned)

```
/api → BGG proxy + scrape routes
/components → CardFront, CardBack, SheetPreview
/lib → helpers (bgg, cache, text, icons, measure)
/stores → Zustand stores
/public → logo assets
/docs → DESIGN.md, architecture diagrams, samples
```


---

## Prompting tips for AI

When using AI assistants in this project:
1. **Always point them to `DESIGN.md`.**
2. **Give them scope**: say what you’re editing (`/components/CardFront.tsx`).
3. **Prefer full file rewrites** instead of patching small chunks (avoids
   drift).
4. **Remind them to use this stack**: Next.js + React + TypeScript + Tailwind +
   shadcn/ui.
5. **Remind them of caching rules**: 90-day short description cache, SWR
   patterns.
6. **Avoid altering architecture** unless this file is updated first.
7. **If asked to break/change conventions**: update this document with the new
   rule.

---

## Definition of done (v1)

- Given a valid BGG username, the app fetches owned games.
- User can select games and preview card fronts/backs.
- PDF exports correctly to A4/Letter with crop marks and optional bleed.
- Covers and short descriptions are cached (90 days).
- No console errors, basic a11y checks pass, tests run green.
